# Analysis of longitudinal data

## BPRS data
Read in the data and convert the `treatment`and `subject` columns to factors.
```{r, warning=FALSE, message=FALSE}
library(tidyverse)
BPRSL <- read.table("data/BPRSL.txt", header = TRUE)
BPRSL$treatment <- as.factor(BPRSL$treatment)
BPRSL$subject <- as.factor(BPRSL$subject)
glimpse(BPRSL)
```
The data seems to be in order.  
Next to the analyses. 

### Non-standardized data
```{r, fig.width=10}
ggplot(BPRSL, aes(x = week, y = bprs, linetype = subject)) +
  geom_line() +
  scale_linetype_manual(values = rep(1:10, times=4)) +
  facet_grid(. ~ treatment, labeller = label_both) +
  theme(legend.position = "none") + 
  scale_y_continuous(limits = c(min(BPRSL$bprs), max(BPRSL$bprs)))
```

### Standardization
As the higher *bprs* value in the beginning means also higher value in the end, standardization is required.  
$$\ standardized(x) = \frac{x-mean(x)}{sd(x)}$$

```{r, fig.width=10}
BPRSL <- BPRSL %>%
  group_by(week) %>%
  mutate(stdbprs = (bprs-mean(bprs))/sd(bprs)) %>%
  ungroup()

ggplot(BPRSL, aes(x = week, y = stdbprs, linetype = subject)) +
  geom_line() +
  scale_linetype_manual(values = rep(1:10, times=4)) +
  facet_grid(. ~ treatment, labeller = label_both) +
  theme(legend.position = "none") + 
  scale_y_continuous(limits = c(min(BPRSL$stdbprs), max(BPRSL$stdbprs)), name = "standardized bprs")
```

### Mean response for treatments

The starndard error of the mean can be calculated with the following equation:
$$\ se = \frac{sd(x)}{\sqrt{n}} $$

```{r}
n <- BPRSL$week %>% unique() %>% length()
BPRS_trmt <- BPRSL %>% group_by(treatment, week) %>% summarize(mean = mean(bprs), se = sd(bprs)/sqrt(n))
glimpse(BPRS_trmt)

ggplot(BPRS_trmt, aes(x=week, y=mean, linetype = treatment, shape = treatment)) + 
  geom_line() +
  scale_linetype_manual(values = c(1,2)) +
  geom_point(size=3) +
  scale_shape_manual(values = c(1,2)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se, linetype="1"), width=0.3) +
  theme(legend.position = c(0.8,0.8), panel.grid = element_blank(), panel.background = element_blank(), panel.border = element_rect(fill = FALSE)) +
  scale_y_continuous(name = "mean(bprs) +/- se(bprs)") 



ggplot(BPRSL, aes(x= as.factor(week), y=bprs, fill=treatment)) +
  geom_boxplot() +
  theme(legend.position = c(0.8,0.8), panel.grid = element_blank(), panel.background = element_blank(), panel.border = element_rect(fill = FALSE)) +
  scale_y_continuous(name = "mean(bprs) +/- se(bprs)") + scale_x_discrete(name = "week") + 
  scale_fill_manual(values=c("grey50", "white"))
```
### Outlier in the data

```{r}
BPRSL8 <- BPRSL %>% 
  filter(week > 0) %>%
  group_by(treatment, subject) %>%
  summarize(mean = mean(bprs)) %>%
  ungroup()

ggplot(BPRSL8, aes(x=treatment, y=mean)) + 
  geom_boxplot() + 
  stat_summary(fun.y = "mean", geom = "point", shape=23, size=4, fill = "white") + 
  theme(legend.position = c(0.8,0.8), panel.grid = element_blank(), panel.background = element_blank(), panel.border = element_rect(fill = FALSE)) +
  scale_y_continuous(name = "mean(bprs), weeks 1-8")
```
One outlier data point can be removed. ANd the data plotted again.

### Without the outlier
```{r}
BPRSL8S1 <- filter(BPRSL8, mean<60)
ggplot(BPRSL8S1, aes(x = treatment, y = mean)) +
  geom_boxplot() +
  stat_summary(fun.y = "mean", geom = "point", shape=23, size=4, fill = "white") +
  scale_y_continuous(name = "mean(bprs), weeks 1-8")
```

## RATS data